---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: node-feature-discovery
  namespace: kube-system
spec:
  chart:
    spec:
      chart: node-feature-discovery
      version: 0.14.2
      sourceRef:
        kind: HelmRepository
        name: node-feature-discovery
        namespace: flux-system
  interval: 1h
  maxHistory: 3
  install:
    crds: CreateReplace
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    crds: CreateReplace
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    worker: &tolerations
      tolerations:
        - key: plex
          operator: Exists
          effect: NoSchedule
    topologyUpdater: *tolerations

    # prometheus:
    #   enable: true
    # tls:
    #   enable: true
    #   certManager: true
    # master:
    #   config:
    #     extraLabelNs: ["nvidia.com"]
    # worker:
    #   config:
    #     core:
    #       sources: ["custom", "pci", "usb", "kernel"]
    #     sources:
    #       usb:
    #         deviceClassWhitelist: ["02", "03", "0e", "ef", "fe", "ff"]
    #         deviceLabelFields: ["class", "vendor", "device"]
    #       pci:
    #         deviceClassWhitelist: ["02", "0200", "0207", "0300", "0302"]
    #         deviceLabelFields: ["vendor"]